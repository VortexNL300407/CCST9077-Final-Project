<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Level 2 - Quantum Cryptography</title>
    <link rel="stylesheet" href="style.css" id="theme-stylesheet">
    <style>
      /* Add background image styling */
      body {
        position: relative;
        background-image: url('media/game2.jpeg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        overflow-x: hidden;
      }
      
      /* Add overlay to improve text readability */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 15, 30, 0.88);
        z-index: -1;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Quantum Cryptography</h1>
      <p><em>Cryptography of the future</em></p>
      <nav>
        <a href="index.html">Home</a>
        <a href="game.html">Game</a>
        <a href="materials.html">Materials</a>
      </nav>
    </header>

    <main class="page">
      <section class="card" id="materials-card">
        <div class="materials-inner">
          <h2 style="text-align:center; margin-top:0;">Level 2 ‚Äî Materials: Quantum Superposition</h2>
          <div class="superposition-card">
            <!-- Explanatory text first -->
            <div class="demo-notes" style="max-width:780px; text-align:center;">
              <p class="demo-note">What is quantum superposition? What does it mean for a bit to be in superposition?</p>
              <p class="demo-note">Think of a normal computer bit as a simple light switch:</p>
              <p class="demo-note">It's either
                <span class="bulb-row" aria-hidden="true">
                  <span class="bulb on" title="ON (1)">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path class="filament" d="M12 2C8.13 2 5 5.13 5 9c0 3.25 1.99 4.96 2.5 5.5.5.5.5 1.5.5 1.5h8c0 0 0-1 .5-1.5C17.01 13.96 19 12.25 19 9c0-3.87-3.13-7-7-7z"/>
                      <rect x="10" y="17" width="4" height="2" rx="0.5" />
                    </svg>
                    <span class="label">1 (ON)</span>
                  </span>
                  <span class="bulb off" title="OFF (0)">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path class="filament" d="M12 2C8.13 2 5 5.13 5 9c0 3.25 1.99 4.96 2.5 5.5.5.5.5 1.5.5 1.5h8c0 0 0-1 .5-1.5C17.01 13.96 19 12.25 19 9c0-3.87-3.13-7-7-7z"/>
                      <rect x="10" y="17" width="4" height="2" rx="0.5" />
                    </svg>
                    <span class="label">0 (OFF)</span>
                  </span>
                </span>
              </p>
              <p class="demo-note">A quantum bit, or qubit, is stranger. Before you look at it, it can be in a state called superposition‚Äîlike a spinning coin that is both Heads and Tails at the same time.</p>
              <p class="demo-note">This lets a quantum computer explore many possible answers to a problem all at once. However, there's a catch: the moment you measure the qubit to check its state, this superposition "collapses." The spinning coin lands, and you only get a single, definite state: either a 0 or a 1.</p>
              <p class="demo-note">Let's use a box analogy with a superposition ball. When you open the box, it has a 50% probability to collapse to the left and 50% probability to fall to the right.</p>

              <!-- Secondary demo (no flashlight) inserted for comparison -->
              <div class="mini-superposition" style="max-width:640px; margin: 0.8rem auto;">
                <div style="text-align:center; margin-bottom:0.4rem; color:#d6e6ff; font-weight:700;">Try this box (no force):</div>
                <div style="display:flex; gap:0.8rem; align-items:center; justify-content:center;">
                  <div class="demo-box" style="width:200px; height:120px;">
                    <div class="demo-inner">
                      <div id="demo-ball-2" class="ball spin" role="img" aria-label="Qubit in superposition">?</div>
                    </div>
                  </div>
                </div>
                <div style="display:flex; gap:0.6rem; margin-top:0.6rem; justify-content:center;">
                  <button id="open-box-2" class="btn">Open Box (Measure)</button>
                  <button id="reset-box-2" class="btn btn-outline">Reset</button>
                </div>
                <div id="demo-result-2" class="demo-result" aria-live="polite" style="margin-top:0.6rem;"></div>
              </div>

              <p class="demo-note">Another key realization is that quantum superposition is NOT simply: The ball is either in left or right and we don't know until we open the box.</p>
              <p class="demo-note">We can prove whether superposition is a whole new state of existence.</p>
              <p class="demo-note">If we apply a FORCE to a SUPERPOSITIONED ball, the ball will always fall to the left.</p>
              <p class="demo-note">If we apply a FORCE to a NON-Superposition ball, the ball will have 50/50 chance of falling on either side of the box when opened.</p>
              <p class="demo-note">Go ahead and see what happens:</p>
              </div>

            <!-- Demo box in the middle -->
            <div style="text-align:center; margin-bottom:0.4rem; color:#d6e6ff; font-weight:700;">Try this box (with force):</div>
            <div class="demo-area">
              <div class="demo-box" aria-hidden="true">
                <div class="demo-inner">
                  <div id="demo-ball" class="ball spin" role="img" aria-label="Qubit in superposition">?</div>
                </div>
              </div>
              <!-- Flash energy element: animated waves travel from the flashlight toward the box -->
              <div id="flash-energy" class="flash-energy" aria-hidden="true">
                <div class="wave w1"></div>
                <div class="wave w2"></div>
                <div class="wave w3"></div>
              </div>
              <!-- Flashlight: represents an applied FORCE that forces collapse to the left -->
              <button id="flashlight" class="flashlight" title="Apply Force (always forces collapse to the left)">üî¶ Force</button>
            </div>

            <!-- Controls below the box -->
            <div class="demo-controls">
              <div class="demo-controls compact" style="gap:0.6rem; margin-bottom:0.6rem;">
                <button id="open-box" class="btn">Open Box (Measure)</button>
                <button id="reset-box" class="btn btn-outline">Reset</button>
              </div>
              <div id="demo-result" class="demo-result" aria-live="polite"></div>
              <div style="margin-top:0.8rem; display:flex; gap:0.6rem; justify-content:center;">
                <button id="view-questions" class="btn">View Questions</button>
                <button id="to-entanglement" class="btn btn-outline">Next: Entanglement</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="card" id="mcq" style="display:none;">
        <h2>Level 2 ‚Äî Knowledge Check (MCQ)</h2>
        <p>Answer the multiple-choice questions to test your understanding.</p>

        <div style="margin-bottom:0.6rem;"><button id="back-to-materials" class="btn btn-outline">Back to Materials</button></div>

        <div id="quiz">
          <div id="question-box">
            <p id="qnum"></p>
            <p id="question" style="font-weight:700;"></p>
            <div id="choices" style="margin-top:0.6rem;"></div>
          </div>

          <div style="margin-top:0.8rem; display:flex; gap:0.6rem;">
            <button id="submit" class="btn">Submit</button>
            <button id="next" class="btn btn-outline" disabled>Next</button>
            <button id="restart" class="btn btn-outline">Restart</button>
          </div>

          <div id="feedback" style="margin-top:1rem; font-weight:700;"></div>
          <div id="explanation" style="margin-top:0.6rem; color:#d0d8ff;"></div>
          <div id="score" style="margin-top:1rem; color:#ffe14a;">Score: 0 / 0</div>
        </div>

        <!-- Evaluation panel shown after last question -->
        <div id="evaluation" style="display:none; margin-top:1rem; padding:1rem; background:rgba(30,30,40,0.7); border-radius:8px;">
          <h3 id="eval-title">Level 2 Summary</h3>
          <p id="eval-text"></p>
          <div style="display:flex; gap:0.6rem; margin-top:0.6rem;">
            <button id="continue-level3" class="btn">Continue to Level 3</button>
            <button id="back-levels" class="btn btn-outline">Back to Levels</button>
          </div>
        </div>

        <p style="margin-top:1.4rem"><a class="btn" href="levels.html">Back to Levels</a></p>
      </section>
    </main>

    <footer>
      &copy; CCST9077 | Members :
    </footer>

    <!-- Levels slide-out tab -->
    <div id="levels-tab" title="Open levels">Levels</div>
    <aside id="levels-sidebar" aria-hidden="true">
      <button id="levels-close" class="btn btn-outline">Close</button>
      <h3>Levels</h3>
      <ul class="levels-list">
        <li><a href="game.html">Level 1 ‚Äî Caesar's Cipher</a></li>
        <li><a href="level2.html">Level 2 ‚Äî Modern Crypto (MCQ)</a></li>
        <li><a href="level3_materials.html">Level 3 ‚Äî QKD Materials</a></li>
      </ul>
    </aside>

    <script>
      (function(){
        const tab = document.getElementById('levels-tab');
        const sidebar = document.getElementById('levels-sidebar');
        const closeBtn = document.getElementById('levels-close');
        if(tab && sidebar){
          tab.addEventListener('click', ()=>{ sidebar.classList.add('open'); sidebar.setAttribute('aria-hidden','false'); });
          closeBtn.addEventListener('click', ()=>{ sidebar.classList.remove('open'); sidebar.setAttribute('aria-hidden','true'); });
          document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ sidebar.classList.remove('open'); sidebar.setAttribute('aria-hidden','true'); } });
        }
      })();
    </script>

    <script>
      // Superposition demo + view toggles for Materials / Questions
      (function(){
        const openBtn = document.getElementById('open-box');
        const resetBtn = document.getElementById('reset-box');
        const ball = document.getElementById('demo-ball');
        const result = document.getElementById('demo-result');
        const viewQ = document.getElementById('view-questions');
        const toEnt = document.getElementById('to-entanglement');
        const backMat = document.getElementById('back-to-materials');
        const materials = document.getElementById('materials-card');
        const mcq = document.getElementById('mcq');
        const flashlight = document.getElementById('flashlight');
        // secondary demo elements (no flashlight)
        const openBtn2 = document.getElementById('open-box-2');
        const resetBtn2 = document.getElementById('reset-box-2');
        const ball2 = document.getElementById('demo-ball-2');
        const result2 = document.getElementById('demo-result-2');

        // When true, the flashlight (force) forces collapse to the left
        let forceLeft = false;
        let measured = false;
        let measured2 = false;

        function collapse() {
          if(measured) return;
          measured = true;
          // If force is applied, always collapse left (0), otherwise random 0/1
          const val = forceLeft ? 0 : (Math.random() < 0.5 ? 0 : 1);
          ball.classList.remove('spin');
          if(val === 0){
            ball.classList.add('left');
            ball.classList.remove('right');
          } else {
            ball.classList.add('right');
            ball.classList.remove('left');
          }
          ball.textContent = val;
          result.textContent = `Measured: ${val} (superposition collapsed)`;
          // If force was active, visually highlight that the left was forced
          if(forceLeft) {
            result.textContent = `Measured: ${val} (FORCE applied ‚Äî collapsed LEFT)`;
            result.classList.add('correct');
          } else {
            result.classList.add('correct');
          }
          openBtn.disabled = true;
        }

        function reset() {
          measured = false;
          ball.classList.remove('left','right');
          ball.classList.add('spin');
          ball.textContent = '?';
          result.textContent = forceLeft ? 'Force still active ‚Äî next collapse will be LEFT' : '';
          result.classList.remove('correct');
          openBtn.disabled = false;
        }

        // Secondary demo collapse/reset (no force)
        function collapse2(){
          if(measured2) return;
          measured2 = true;
          const val = Math.random() < 0.5 ? 0 : 1;
          ball2.classList.remove('spin');
          if(val === 0){ ball2.classList.add('left'); ball2.classList.remove('right'); }
          else { ball2.classList.add('right'); ball2.classList.remove('left'); }
          ball2.textContent = val;
          result2.textContent = `Measured: ${val} (superposition collapsed)`;
          result2.classList.add('correct');
          if(openBtn2) openBtn2.disabled = true;
        }

        function reset2(){
          measured2 = false;
          if(ball2) { ball2.classList.remove('left','right'); ball2.classList.add('spin'); ball2.textContent = '?'; }
          if(result2) { result2.textContent = ''; result2.classList.remove('correct'); }
          if(openBtn2) openBtn2.disabled = false;
        }

        // flashlight toggles the applied force and triggers an energy pulse visualization
        let pulseTimeout = null;
        const demoArea = document.querySelector('.demo-area');
        const demoBox = document.querySelector('.demo-box');
        function energizePulse(){
          if(!demoArea) return;
          // restart animation if already energized
          demoArea.classList.remove('energized');
          demoBox && demoBox.classList.remove('glow');
          void demoArea.offsetWidth;
          demoArea.classList.add('energized');
          demoBox && demoBox.classList.add('glow');
          clearTimeout(pulseTimeout);
          pulseTimeout = setTimeout(()=>{ demoArea.classList.remove('energized'); demoBox && demoBox.classList.remove('glow'); }, 1000);
        }

        if(flashlight){
          flashlight.addEventListener('click', ()=>{
            forceLeft = !forceLeft;
            flashlight.classList.toggle('on', forceLeft);
            flashlight.textContent = forceLeft ? 'üî¶ Forced: Left' : 'üî¶ Force';
            // show a short wavy energy pulse from the flashlight to the box
            energizePulse();
            // update result hint when not yet measured
            if(!measured){
              result.textContent = forceLeft ? 'Force applied: collapse will be LEFT' : '';
            }
          });
        }

        if(openBtn) openBtn.addEventListener('click', collapse);
        if(resetBtn) resetBtn.addEventListener('click', reset);
        if(openBtn2) openBtn2.addEventListener('click', collapse2);
        if(resetBtn2) resetBtn2.addEventListener('click', reset2);
        if(viewQ) viewQ.addEventListener('click', ()=>{ if(materials) materials.style.display = 'none'; if(mcq) mcq.style.display = 'block'; window.scrollTo({ top: 0, behavior: 'smooth' }); });
        if(toEnt) toEnt.addEventListener('click', ()=>{ window.location.href = 'entanglement.html'; });
        if(backMat) backMat.addEventListener('click', ()=>{ if(mcq) mcq.style.display = 'none'; if(materials) materials.style.display = 'block'; window.scrollTo({ top: 0, behavior: 'smooth' }); });

        // initialize
        reset();

        // If this page was opened with #mcq, show the questions view immediately
        if(window.location.hash === '#mcq'){
          if(materials) materials.style.display = 'none';
          if(mcq) mcq.style.display = 'block';
          // scroll to top for visibility
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        // Support redirect to Level 3 Materials from in-page flows
        function goToLevel3Materials(){ window.location.href = 'level3_materials.html'; }
      })();
    </script>

    <script>
      // Level 2 MCQ logic
      (function(){
        const questions = [
          {
            q: "A qubit is in a perfect superposition, meaning it's exactly halfway between 0 and 1. What happens when you measure it?",
            choices: [
              "It stays in superposition.",
              "You get either a 0 or a 1, with equal probability.",
              "You get both a 0 and a 1 simultaneously.",
              "The qubit is destroyed."
            ],
            correct: 1,
            explanation: "Measurement forces the qubit to collapse into a single, definite state. In a perfect 'halfway' superposition, the outcome is completely random, like a fair coin flip. You have a 50/50 chance of finding it as a 0 or a 1."
          },
          {
            q: "What is the main advantage of a qubit being in superposition?",
            choices: [
              "It makes the qubit physically smaller.",
              "It transmits information faster than light.",
              "It allows a quantum computer to perform many calculations at the same time.",
              "It makes the qubit immune to errors."
            ],
            correct: 2,
            explanation: "Because a qubit can represent multiple states at once, a quantum computer can use this property to process a massive number of possibilities simultaneously. This 'quantum parallelism' is a key source of its potential speed for certain problems."
          },
          {
            q: "How is the information from a measured qubit different from a classical bit?",
            choices: [
              "It contains more information after being measured.",
              "It is exactly the same; it's just a 0 or a 1.",
              "It can be used to send messages into the past.",
              "It is stored in a more durable format."
            ],
            correct: 1,
            explanation: "Once measured, the qubit's superposition is gone, and the result is a perfectly ordinary classical bit‚Äîa definitive 0 or a 1. The quantum 'magic' happens before the measurement, during the calculation."
          },
          {
            q: "What is the key property of entangled particles, as described in the passage?",
            choices: [
              "They can be used to send instant messages across any distance.",
              "Measuring one particle instantly tells you something about the other, even if it's far away.",
              "They are physically connected by an invisible force field.",
              "They always have to be created in the same location."
            ],
            correct: 1,
            explanation: "This is the core 'spooky' idea of entanglement. The particles share a quantum connection, so the act of measuring one (and getting a random result) immediately determines the corresponding state of its partner. It's a powerful correlation, but not a communication channel."
          },
          {
            q: "Why can't entangled particles be used to send a message instantly, like a text?",
            choices: [
              "Because the connection between them is slower than light.",
              "Because the person measuring the particles can't control the random outcome.",
              "Because the particles stop being entangled if they are too far apart.",
              "Because the message gets lost in space."
            ],
            correct: 1,
            explanation: "The person measuring one of the entangled particles has no control over whether they get a result equivalent to 'heads' or 'tails.' It's completely random. Since they can't force it to be a specific value, they can't encode a meaningful message. The correlation is only apparent later, when both sides compare their random results and find they match."
          }
        ];
        
        // Added question from user: Which Quantum Algorithm should we utilize to break through Alice and Bob‚Äôs Public Key Cryptography Security?
        questions.push({
          q: "Which Quantum Algorithm should we utilize to break through Alice and Bob‚Äôs Public Key Cryptography Security?",
          choices: [
            "Shor‚Äôs Algorithm",
            "HHL Algorithm",
            "Grover‚Äôs Algorithm",
            "Deutsch-Josza Algorithm"
          ],
          correct: 0,
          explanation: "Ans: A) Because Shor‚Äôs Algorithm was designed to efficiently break RSA Public Key Cryptography in less than a day."
        });

        let idx = 0; let score = 0; let attempts = 0; let answered = false;

        const qnum = document.getElementById('qnum');
        const qel = document.getElementById('question');
        const choicesEl = document.getElementById('choices');
        const submit = document.getElementById('submit');
        const next = document.getElementById('next');
        const restart = document.getElementById('restart');
        const feedback = document.getElementById('feedback');
        const explanation = document.getElementById('explanation');
        const scoreEl = document.getElementById('score');
        const evalPanel = document.getElementById('evaluation');
        const evalText = document.getElementById('eval-text');
        const continueBtn = document.getElementById('continue-level3');
        const backLevelsBtn = document.getElementById('back-levels');

        function render(){
          const cur = questions[idx];
          qnum.textContent = `Question ${idx+1} of ${questions.length}`;
          qel.textContent = cur.q;
          choicesEl.innerHTML = '';
          cur.choices.forEach((c,i)=>{
            const id = `choice-${i}`;
            const wrapper = document.createElement('div');
            wrapper.style.margin = '0.4rem 0';
            wrapper.innerHTML = `<label style=\"cursor:pointer;\"><input type=\"radio\" name=\"choice\" value=\"${i}\" id=\"${id}\" /> ${String.fromCharCode(97+i)}) ${c}</label>`;
            choicesEl.appendChild(wrapper);
          });
          feedback.textContent = '';
          explanation.textContent = '';
          // animate question entrance
          const questionBox = document.getElementById('question-box');
          if(questionBox){
            questionBox.classList.remove('animate-question');
            // trigger reflow then add class to restart animation
            void questionBox.offsetWidth;
            questionBox.classList.add('animate-question');
            questionBox.addEventListener('animationend', function aq(){ questionBox.classList.remove('animate-question'); questionBox.removeEventListener('animationend', aq); });
          }
          submit.disabled = false;
          next.disabled = true;
          answered = false;
          // hide evaluation panel if shown
          if(evalPanel) evalPanel.style.display = 'none';
          updateScore();
        }

        function updateScore(){ scoreEl.textContent = `Score: ${score} / ${questions.length}`; }

        function getSelected(){ const r = document.querySelector('input[name="choice"]:checked'); return r ? parseInt(r.value,10) : null; }

        submit.addEventListener('click', ()=>{
          if(answered) return;
          const sel = getSelected();
          if(sel === null){
            feedback.style.color = '#ffd36a';
            feedback.textContent = 'Please select an answer.';
            feedback.classList.remove('animate-feedback'); void feedback.offsetWidth; feedback.classList.add('animate-feedback');
            return;
          }
          attempts++;
          if(sel === questions[idx].correct){
            feedback.style.color = '#7ef27e'; feedback.textContent = 'Correct!'; score++;
            explanation.textContent = questions[idx].explanation || '';
            // animate feedback and explanation
            feedback.classList.remove('animate-feedback'); void feedback.offsetWidth; feedback.classList.add('animate-feedback');
            explanation.classList.remove('animate-explain'); void explanation.offsetWidth; explanation.classList.add('animate-explain');
            submit.disabled = true; next.disabled = false; answered = true;
          } else {
            feedback.style.color = '#ff9a9a'; feedback.textContent = 'Incorrect. Review the explanation and try the next question.';
            explanation.textContent = questions[idx].explanation || '';
            feedback.classList.remove('animate-feedback'); void feedback.offsetWidth; feedback.classList.add('animate-feedback');
            explanation.classList.remove('animate-explain'); void explanation.offsetWidth; explanation.classList.add('animate-explain');
            submit.disabled = true; next.disabled = false; answered = true;
          }
          updateScore();
        });

        next.addEventListener('click', ()=>{
          // If not at last question, go to next; otherwise show evaluation summary
          if(idx + 1 < questions.length){
            idx = idx + 1;
            render();
          } else {
            // Show evaluation summary (flexible to number of questions)
            evalText.textContent = `You scored ${score} out of ${attempts} attempted questions.`;
            evalPanel.style.display = 'block';
            // add entrance animation to evaluation
            evalPanel.classList.remove('animate-eval'); void evalPanel.offsetWidth; evalPanel.classList.add('animate-eval');
            // disable quiz controls while evaluation is visible
            submit.disabled = true;
            next.disabled = true;
          }
        });

        continueBtn.addEventListener('click', ()=>{
          // Optionally could pass data via query params/localStorage
          window.location.href = 'level3_materials.html';
        });

        backLevelsBtn.addEventListener('click', ()=>{
          window.location.href = 'levels.html';
        });

        restart.addEventListener('click', ()=>{ idx = 0; score = 0; attempts = 0; render(); });

        render();
      })();
    </script>
  </body>

  <!-- PARALLAX EFFECT SCRIPT -->
  <script>
    (function(){
      const body = document.body;
      if(!body) return;
      
      let ticking = false;
      const parallaxSpeed = -0.05;
      
      // Calculate initial offset to prevent jump
      const initialScroll = window.pageYOffset;
      const initialOffset = initialScroll * parallaxSpeed;
      
      function updateParallax() {
        const scrolled = window.pageYOffset;
        const offset = scrolled * parallaxSpeed;
        
        // Apply offset relative to initial position
        body.style.backgroundPositionY = `calc(50% + ${offset}px)`;
        
        ticking = false;
      }
      
      function requestTick() {
        if (!ticking) {
          window.requestAnimationFrame(updateParallax);
          ticking = true;
        }
      }
      
      // Set initial position
      body.style.backgroundPositionY = `calc(50% + ${initialOffset}px)`;
      
      window.addEventListener('scroll', requestTick, { passive: true });
    })();
  </script>
  <!-- END PARALLAX EFFECT SCRIPT -->

  <!-- Audio element for background music -->
  <audio id="bgm" loop>
    <source src="media/bgm.mp3" type="audio/mpeg">
  </audio>
  <div id="settings-btn">‚öôÔ∏è</div>
  <div id="settings-menu">
    <div id="mute-option" class="option">Mute Music</div>
    <div id="theme-option" class="option">üîÑ Larger Fonts (Accessibility)</div>
  </div>
  <div id="info-container">
    <div id="info-icon">‚Ñπ</div>
    <div id="info-popup">This project is an informative and educational website designed to make information on quantum cryptography accessible to a wider audience.</div>
  </div>

  <!-- BACKGROUND MUSIC SYSTEM -->
  <script>
    (function(){
      const bgm = document.getElementById('bgm');
      if(!bgm) return;
      const btn = document.getElementById('settings-btn');
      const menu = document.getElementById('settings-menu');
      const muteOption = document.getElementById('mute-option');
      let menuOpen = false;

      let savedMuted = localStorage.getItem('musicMuted') === 'true';
      let savedTime = parseFloat(localStorage.getItem('musicTime')) || 0;
      bgm.muted = savedMuted;
      bgm.currentTime = savedTime;

      window.addEventListener('click', ()=>{ bgm.play().catch(()=>{}); bgm.volume = 0.2; }, { once: true });
      bgm.volume = 0.2; bgm.play().catch(()=>{});

      setInterval(()=>{ localStorage.setItem('musicTime', bgm.currentTime); }, 1000);

      btn.onclick = ()=>{ menuOpen = !menuOpen; menu.style.display = menuOpen ? 'block' : 'none'; };
      muteOption.onclick = ()=>{ bgm.muted = !bgm.muted; localStorage.setItem('musicMuted', bgm.muted); muteOption.textContent = bgm.muted ? 'Unmute Music' : 'Mute Music'; };
      muteOption.textContent = bgm.muted ? 'Unmute Music' : 'Mute Music';
    })();
  </script>
  <!-- END BACKGROUND MUSIC SYSTEM -->

  <!-- THEME SWITCHER SCRIPT -->
  <script>
    (function(){
      const themeOption = document.getElementById('theme-option');
      const themeSheet = document.getElementById('theme-stylesheet');
      if(!themeOption || !themeSheet) return;

      let useAccessibleTheme = localStorage.getItem('useAccessibleTheme') === 'true';
      
      function applyTheme(accessible) {
        if(accessible) {
          themeSheet.href = 'styl2.css';
          themeOption.textContent = 'üîÑ Standard Fonts';
          localStorage.setItem('useAccessibleTheme', 'true');
        } else {
          themeSheet.href = 'style.css';
          themeOption.textContent = 'üîÑ Larger Fonts (Accessibility)';
          localStorage.setItem('useAccessibleTheme', 'false');
        }
      }

      applyTheme(useAccessibleTheme);

      themeOption.addEventListener('click', ()=>{
        useAccessibleTheme = !useAccessibleTheme;
        applyTheme(useAccessibleTheme);
      });
    })();
  </script>
  <!-- END THEME SWITCHER SCRIPT -->
</html>
