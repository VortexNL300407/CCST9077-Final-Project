<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quantum Cryptography - Materials</title>
    <link rel="stylesheet" href="style.css" id="theme-stylesheet">
    <style>
      /* Add background image styling */
      main.page {
        position: relative;
        background-image: url('media/quantum.jpeg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        overflow-x: hidden;
      }
      
      /* Add overlay to improve text readability */
      main.page::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 15, 30, 0.88);
        z-index: 0;
      }
      
      /* Ensure content is above the overlay */
      main.page > * {
        position: relative;
        z-index: 1;
      }
      
      /* Caesar Cipher Wheel Styles */
      #caesar-wheel-svg text { 
        font-family: system-ui, sans-serif; 
        font-size: 14px; 
        dominant-baseline: middle; 
        text-anchor: middle; 
        fill: #fff; 
      }
      #caesar-wheel-svg circle { 
        fill: none; 
        stroke: rgba(255,255,255,0.25); 
      }
      
      /* Range slider styling for Caesar wheel */
      #caesar-shift::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #00ffff, #57acf6);
        cursor: pointer;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
      }

      #caesar-shift::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #00ffff, #57acf6);
        cursor: pointer;
        border: none;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
      }
    </style>
  </head>
  <body>
    <header>
      <!-- Inline SVG logo -->
      <div class="logo" aria-hidden="false" style="display:inline-block; vertical-align:middle; margin-bottom:0.4rem;">
        <svg width="60" height="60" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Site logo">
          <rect width="64" height="64" rx="10" fill="#1b2740" />
          <circle cx="32" cy="24" r="12" fill="#57acf6" />
          <text x="32" y="38" font-size="18" text-anchor="middle" fill="#fff" font-family="Verdana,Arial" font-weight="700">Q</text>
        </svg>
      </div>
      <h1 style="display:inline-block; margin-left:0.6rem; vertical-align:middle;">Quantum Cryptography</h1>
      <p><em>Cryptography of the future</em></p>
      <nav>
        <a href="index.html">Home</a>
        <a href="game.html">Game</a>
        <a href="materials.html">Materials</a>
      </nav>
    </header>

    <main class="page">
      <!-- Combined Materials: Level 2 Superposition + Entanglement -->
      <section class="card" id="materials-combined">
        <!-- Caesar Cipher Section -->
        <h2 style="text-align:center; margin-top:0;">Materials ‚Äî Caesar Cipher</h2>
        
        <div style="max-width:900px; margin:1rem auto; color:#dbe7ff; line-height:1.6;">
          <h3>What is Caesar Cipher?</h3>
          <p>The Caesar Cipher is one of the oldest and simplest encryption techniques. Named after Julius Caesar, who used it to protect his military messages, this cipher works by shifting each letter in the plaintext by a fixed number of positions in the alphabet.</p>

          <h3>How Caesar Cipher Works</h3>
          <ol>
            <li><strong>Choose a shift value</strong> (also called the "key") ‚Äî for example, a shift of 3.</li>
            <li><strong>Replace each letter</strong> in your message by moving it forward (or backward) in the alphabet by the shift amount.</li>
            <li>For example, with a shift of +3:
              <ul style="margin-top:0.5rem;">
                <li>A ‚Üí D</li>
                <li>B ‚Üí E</li>
                <li>C ‚Üí F</li>
                <li>... and so on</li>
              </ul>
            </li>
            <li><strong>To decrypt</strong>, simply reverse the process by shifting backwards by the same amount.</li>
          </ol>

          <h3>Example</h3>
          <div style="background:rgba(10,18,30,0.25); padding:1rem; border-radius:6px; margin:1rem 0;">
            <p style="margin:0.5rem 0;"><strong>Plaintext:</strong> HELLO</p>
            <p style="margin:0.5rem 0;"><strong>Shift:</strong> +3</p>
            <p style="margin:0.5rem 0;"><strong>Ciphertext:</strong> KHOOR</p>
          </div>

          <h3>Interactive Cipher Wheel</h3>
          <p>Below is a Caesar cipher wheel that lets you visualize how the encryption works. The inner ring shows the original alphabet (plaintext), and the outer ring shows the shifted alphabet (ciphertext). Adjust the shift slider to see how different shift values transform the letters.</p>
        </div>

        <!-- Cipher Wheel -->
        <div id="caesar-wheel-container" style="max-width:900px; margin:1.2rem auto; background:rgba(10,18,30,0.25); padding:1.5rem; border-radius:6px;">
          <div style="display:flex; align-items:center; gap:1.5rem; flex-wrap:wrap; justify-content: center;">
            <svg id="caesar-wheel-svg" viewBox="0 0 260 260" width="260" height="260" role="img" aria-label="Caesar cipher wheel" style="width:260px; height:260px;">
              <!-- SVG content will be generated by JavaScript -->
            </svg>
            <div style="flex:1; min-width:250px;">
              <div style="color:#57acf6; font-weight:bold; font-size:1.1rem; margin-bottom:0.6rem;">Cipher Wheel Shift</div>
              <div style="font-size:0.9rem; opacity:0.9; margin-bottom:0.6rem;">Rotate the outer ring to align plaintext with ciphertext</div>
              <label for="caesar-shift" style="color: #57acf6; font-weight: bold; display:block; margin-bottom:0.4rem;">
                Shift: <span id="caesar-shift-label" style="color:#00ffff; font-size:1.5rem; font-weight:bold; text-shadow:0 0 10px rgba(0,255,255,0.5);">0</span>
              </label>
              <input id="caesar-shift" type="range" min="-25" max="25" step="1" value="0" style="width:100%; height:8px; border-radius:5px; background:rgba(87,172,246,0.2); outline:none;">
              <div style="margin-top:1rem; padding:1rem; background:rgba(0,255,255,0.1); border-left:4px solid #00ffff; border-radius:6px;">
                <div style="font-weight:bold; margin-bottom:0.5rem;">Try it out:</div>
                <div style="display:flex; gap:1rem; align-items:center; flex-wrap:wrap;">
                  <div style="flex:1; min-width:150px;">
                    <label style="display:block; margin-bottom:0.3rem; font-size:0.9rem; opacity:0.9;">Plaintext Word:</label>
                    <input id="plain-letter" type="text" maxlength="5" placeholder="HELLO" value="HELLO" style="width:100%; padding:0.5rem; background:rgba(10,15,36,0.8); border:2px solid rgba(0,255,255,0.4); color:#fff; font-family:'Courier New',monospace; font-size:1.2rem; border-radius:6px; text-align:center; box-sizing:border-box;">
                  </div>
                  <div style="color:#00ffff; font-size:1.5rem; padding-top:1.5rem;">‚Üí</div>
                  <div style="flex:1; min-width:150px;">
                    <label style="display:block; margin-bottom:0.3rem; font-size:0.9rem; opacity:0.9;">Encrypted Word:</label>
                    <div id="cipher-letter" style="width:100%; padding:0.5rem; background:rgba(0,255,255,0.05); border:2px solid rgba(0,255,255,0.4); color:#00ffff; font-family:'Courier New',monospace; font-size:1.2rem; border-radius:6px; text-align:center; font-weight:bold; box-sizing:border-box; min-height:2.4rem;">HELLO</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div style="max-width:900px; margin:1rem auto; color:#dbe7ff; line-height:1.6;">
          <h3>Strengths and Weaknesses</h3>
          <p><strong>Strengths:</strong> The Caesar cipher is simple to use and understand, making it great for learning about encryption basics.</p>
          <p><strong>Weaknesses:</strong> With only 25 possible shifts, it's extremely vulnerable to brute-force attacks. An attacker can easily try all possible keys. Additionally, frequency analysis can reveal patterns in the encrypted text, making it easy to crack.</p>
      

        <h2 style="text-align:center; margin-top:2rem;">Materials ‚Äî Superposition & Entanglement</h2>


        <!-- Superposition demo (copied from level2 materials) -->
        <div class="superposition-card" style="margin-top:1.2rem;">
          <div class="demo-notes" style="max-width:780px; text-align:center; margin:0 auto 1rem;">
            <p class="demo-note">What is quantum superposition? What does it mean for a bit to be in superposition?</p>
            <p class="demo-note">Think of a normal computer bit as a simple light switch:</p>
            <p class="demo-note">It's either
              <span class="bulb-row" aria-hidden="true">
                <span class="bulb on" title="ON (1)">
                  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path class="filament" d="M12 2C8.13 2 5 5.13 5 9c0 3.25 1.99 4.96 2.5 5.5.5.5.5 1.5.5 1.5h8c0 0 0-1 .5-1.5C17.01 13.96 19 12.25 19 9c0-3.87-3.13-7-7-7z"/>
                    <rect x="10" y="17" width="4" height="2" rx="0.5" />
                  </svg>
                  <span class="label">1 (ON)</span>
                </span>
                <span class="bulb off" title="OFF (0)">
                  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path class="filament" d="M12 2C8.13 2 5 5.13 5 9c0 3.25 1.99 4.96 2.5 5.5.5.5.5 1.5.5 1.5h8c0 0 0-1 .5-1.5C17.01 13.96 19 12.25 19 9c0-3.87-3.13-7-7-7z"/>
                    <rect x="10" y="17" width="4" height="2" rx="0.5" />
                  </svg>
                  <span class="label">0 (OFF)</span>
                </span>
              </span>
            </p>
            <p class="demo-note">A quantum bit, or qubit, is stranger. Before you look at it, it can be in a state called superposition‚Äîlike a spinning coin that is both Heads and Tails at the same time.</p>
            <p class="demo-note">This lets a quantum computer explore many possible answers to a problem all at once. However, there's a catch: the moment you measure the qubit to check its state, this superposition "collapses." The spinning coin lands, and you only get a single, definite state: either a 0 or a 1.</p>
            <p class="demo-note">Let's use a box analogy with a superposition ball. When you open the box, it has a 50% probability to collapse to the left and 50% probability to fall to the right.</p>
          </div>

          <!-- No-force demo -->
          <div class="mini-superposition" style="max-width:640px; margin: 0.8rem auto;">
            <div style="text-align:center; margin-bottom:0.4rem; color:#d6e6ff; font-weight:700;">Try this box (no force):</div>
            <div style="display:flex; gap:0.8rem; align-items:center; justify-content:center;">
              <div class="demo-box" style="width:200px; height:120px;">
                <div class="demo-inner">
                  <div id="demo-ball-2" class="ball spin" role="img" aria-label="Qubit in superposition">?</div>
                </div>
              </div>
            </div>
            <div style="display:flex; gap:0.6rem; margin-top:0.6rem; justify-content:center;">
              <button id="open-box-2" class="btn">Open Box (Measure)</button>
              <button id="reset-box-2" class="btn btn-outline">Reset</button>
            </div>
            <div id="demo-result-2" class="demo-result" aria-live="polite" style="margin-top:0.6rem;"></div>
          </div>

          <p class="demo-note">Another key realization is that quantum superposition is NOT simply: The ball is either in left or right and we don't know until we open the box.</p>
          <p class="demo-note">If we apply a FORCE to a SUPERPOSITIONED ball, the ball will always fall to the left.</p>
          <p class="demo-note">If we apply a FORCE to a NON-Superposition ball, the ball will have 50/50 chance of falling on either side of the box when opened.</p>

          <!-- Force demo -->
          <div style="text-align:center; margin-bottom:0.4rem; color:#d6e6ff; font-weight:700;">Try this box (with force):</div>
          <div class="demo-area" style="margin-bottom:0.6rem;">
            <div class="demo-box" aria-hidden="true">
              <div class="demo-inner">
                <div id="demo-ball" class="ball spin" role="img" aria-label="Qubit in superposition">?</div>
              </div>
            </div>
            <div id="flash-energy" class="flash-energy" aria-hidden="true">
              <div class="wave w1"></div>
              <div class="wave w2"></div>
              <div class="wave w3"></div>
            </div>
            <button id="flashlight" class="flashlight" title="Apply Force (always forces collapse to the left)">üî¶ Force</button>
          </div>

          <!-- Controls: Open/Reset and navigation -->
          <div class="demo-controls">
            <div class="demo-controls compact" style="gap:0.6rem; margin-bottom:0.6rem; justify-content:center;">
              <button id="open-box" class="btn">Open Box (Measure)</button>
              <button id="reset-box" class="btn btn-outline">Reset (Re-superpose)</button>
            </div>
            <div id="demo-result" class="demo-result" aria-live="polite"></div>
            <!-- navigation removed: materials-only page -->
          </div>
        </div>

        <!-- Entanglement demo (copied from entanglement materials) -->
        <div style="margin-top:1.6rem;">
          <h3 style="text-align:center; margin-top:0;">Entanglement ‚Äî Two-Particle Correlation</h3>
          <p style="text-align:center; max-width:820px; margin:0.6rem auto; color:#d6e6ff;">Entanglement is a quantum connection between two particles so strong that measuring one immediately affects the other, even when they're apart. The following demo shows a simplified model: measure the left particle and the right one will show a correlated result.</p>
          <p style="text-align:center; max-width:820px; margin:0.6rem auto; color:#d6e6ff;">Imagine you have a pair of gloves. Two boxes contain each pair of gloves, you don‚Äôt know which contains the left-hand glove and which contains the right-hand glove. You and your friend each choose one and take it home. When either one of you opens the box, both of you will know which glove is in the second box before opening it. Confirming by opening the second box will prove that it's the other pair.</p>
          <p style="text-align:center; max-width:820px; margin:0.6rem auto; color:#d6e6ff;">When two particles are entangled, they are linked in such a way that measuring one instantly influences the state of the other, no matter how far apart they are. This connection is faster than light and seems to defy our everyday experience. However, you cannot use it to send a message. The outcome of your measurement is random, but when one particle has been measured to a defined state, the other particle will obtain the same exact state when measured.</p>

          <div style="display:flex; gap:1.2rem; align-items:flex-start; justify-content:center; margin-top:1rem; flex-wrap:wrap;">
            <div style="text-align:center; width:220px;">
              <div class="demo-box" style="width:180px; height:130px; margin:0 auto;">
                <div class="demo-inner">
                  <div id="ent-ball-l" class="ball spin" role="img" aria-label="Left entangled particle">?</div>
                </div>
              </div>
              <div style="margin-top:0.6rem; display:flex; justify-content:center;">
                <button id="measure-l" class="btn">Measure Left</button>
              </div>
              <div id="ent-result-l" class="demo-result" style="margin-top:0.6rem;"></div>
            </div>

            <div style="text-align:center; width:220px;">
              <div class="demo-box" style="width:180px; height:130px; margin:0 auto;">
                <div class="demo-inner">
                  <div id="ent-ball-r" class="ball spin" role="img" aria-label="Right entangled particle">?</div>
                </div>
              </div>
              <div style="margin-top:0.6rem; display:flex; justify-content:center;">
                <button id="measure-r" class="btn">Measure Right</button>
              </div>
              <div id="ent-result-r" class="demo-result" style="margin-top:0.6rem; text-align:center; min-width:120px;"></div>
            </div>
          </div>

          <div style="display:flex; justify-content:center; margin-top:0.8rem;">
            <button id="reset-ent" class="btn btn-outline">Reset</button>
          </div>

          <div style="text-align:center; margin-top:1.2rem; color:#d6e6ff;">Tip: Measuring either particle collapses the pair; in this simplified demo measurements are perfectly correlated.</div>
        </div>

        <div style="max-width:900px; margin:1rem auto; color:#dbe7ff; line-height:1.6;">
          <h3 style="text-align:center; margin-top:0;">Materials ‚Äî Quantum Computing</h3>

          <p>Many common misunderstandings about why Quantum Computers can be more efficient than Classical Computers is that ‚ÄúQuantum Computers can do computations in parallel.‚Äù Although this is somewhat true, we must take into account the second step at which Quantum Computers take to truly gain an efficiency advantage over Classical Algorithms.</p>

          <p>With Quantum Superposition, we can essentially allow our qubits to do computation in parallel, yes. But to actually calculate the outputs of these computations, we would have to essentially ‚ÄúOpen the box‚Äù. But doing so would result in the superposition of these qubits to collapse to one of the many parallel possibilities. This would essentially be the same or maybe even worse than computing every possible computation one by one with Classical Algorithms.</p>

          <p>To gain a computational advantage, we must use a method in which we can ‚ÄúFilter‚Äù the superpositioned qubits in such a way that we can remove the Unfavorable States from the Favorable States that we want. To do this, quantum computers use a sort of interference. The same way waves, when interfere with another, will interact with each other such that opposing amplitudes cancel out and like amplitudes amplify.</p>

          <p>The challenge of implementing both Parallel Computing and Interference is what makes Quantum Algorithms hard to design. It is not a ‚Äúholy grail‚Äù nor a quick solution for every problem and algorithm. The algorithms that have been developed today are:</p>

          <ul style="margin-top:0.6rem; color:#dbe7ff;">
            <li>Shor‚Äôs Algorithm ‚Üí To break Modern Public Key Cryptography</li>
            <li>Harrow-Hassidim-Lloyd (HHL) Algorithm : To Solve Linear Equations</li>
            <li>Grover‚Äôs Algorithm : To Search Through an Unstructured Database</li>
            <li>Deutsch-Josza Algorithm : For Pure Mathematical Problems</li>
          </ul>
        </div>

      </br>
        <h2 style="text-align:center; margin-top:0;">Materials ‚Äî Quantum Key Distribution & BB84 Protocol</h2>

        <!-- Level 3: BB84 materials (interactive simulations) -->
        <div style="max-width:900px; margin:1rem auto; color:#dbe7ff; line-height:1.6;">
          <h3>What is QKD (BB84)?</h3>
          <p>Quantum Key Distribution is a certain protocol created to demonstrate how we can utilize Quantum Superposition and Entanglement properties to create a guaranteed secure communication channel. Protocols like the BB84 and E91 Protocols were created in 1984 and 1991 respectively to implement the idea of a secure communication channel with Quantum Superposition and Entanglement.</p>

          <h3>How BB84 Protocol works (high level)</h3>
          <ol>
            <li><strong>Alice</strong> prepares a sequence of qubits.</li>
            <li>For each bit, Alice chooses a basis: Horizontal/Vertical (+) or 45¬∞/-45¬∞ (√ó) and notes the value (0 or 1) she obtains when measuring in that basis.</li>
            <li><strong>Alice</strong> sends the sequence of qubits through an insecure channel to Bob.</li>
            <li><strong>Bob</strong> measures each incoming qubit using either + or √ó bases (his choice may differ from Alice's).</li>
            <li>After the transmission, Alice and Bob publicly announce which basis they used for each qubit (but not the measurement outcomes).</li>
            <li>They keep only the bits where they happened to use the same basis; these form the shared raw key.</li>
            <li>If any of the kept bits disagree, that indicates an eavesdropper disturbed the qubits during transmission.</li>
          </ol>
        </div>
        <!-- BB84 interactive simulation -->
        <div id="bb84-sim" style="max-width:900px; margin:1.2rem auto; background:rgba(10,18,30,0.25); padding:1rem; border-radius:6px;">
          <h3 style="text-align:center; margin-top:0;">Interactive BB84 Simulation (5 qubits)</h3>
          <p style="text-align:center; color:#d6e6ff;">Act as Alice and Bob: choose the measurement basis for each qubit, measure, then compare bases to derive the shared key.</p>

          <div style="display:flex; justify-content:center; gap:0.5rem; margin-bottom:0.6rem;">
            <button id="bb84-gen" class="btn">Generate New Sequence</button>
            <button id="alice-measure" class="btn">Alice: Measure All</button>
            <button id="bob-measure" class="btn">Bob: Measure All</button>
            <button id="bb84-reset" class="btn btn-outline">Reset</button>
          </div>

          <div class="bb84-headers" style="display:grid; grid-template-columns:1fr 1fr 1fr; align-items:center; gap:0.6rem; padding:0.2rem 0.4rem; color:#cfe9ff; font-weight:600;">
            <div style="grid-column:1; display:flex; align-items:center; text-align:left">Alice ‚Äî Basis & Value</div>
            <div style="grid-column:2 ; display:flex; align-items:center; justify-content:center;text-align:center">Bob ‚Äî Basis & Value</div>
            <div style="grid-column:3; display:flex; align-items:center; justify-content:center; text-align:center">Result</div>
          </div>

          <div id="bb84-container" style="display:grid; gap:0.6rem; grid-template-columns:1fr;">
            <!-- Per-qubit rows injected here -->
          </div>


          <div id="bb84-result" style="margin-top:0.8rem; text-align:center; color:#d6e6ff;">
            <div id="bb84-matches" style="margin-bottom:0.4rem;"></div>
            <div id="bb84-key" style="font-weight:600; font-family:monospace; background:rgba(255,255,255,0.03); display:inline-block; padding:0.4rem 0.6rem; border-radius:4px;"></div>
          </div>
        </div>


        <div>
          <h3>Why eavesdropping is detectable</h3>
          <p>We must be careful! If we don't know the measurements Alice used, we might disturb the entanglement property of the qubits. If this happens, Alice and Bob can see the high error rate on qubits that they measure with the same type of measurement, prompting them to abort the key.</p>

          <!-- BB84 with Eve simulation (inserted before 'What you'll practice') -->
          <div id="bb84-eve-sim" style="max-width:900px; margin:1.2rem auto; background:rgba(10,18,30,0.18); padding:1rem; border-radius:6px;">
            <h3 style="text-align:center; margin-top:0;">BB84 ‚Äî With Eve (Eavesdropper)</h3>
            <p style="text-align:center; color:#d6e6ff;">Follow Alice ‚Üí Eve ‚Üí Bob. Try letting Eve measure with different bases and observe how that disturbs the key.</p>

            <div style="display:flex; justify-content:center; gap:0.5rem; margin-bottom:0.6rem;">
              <button id="bb84-e-gen" class="btn">Generate New Sequence</button>
              <button id="alice-e-measure" class="btn">Alice: Measure All</button>
              <button id="eve-measure" class="btn">Eve: Intercept & Measure</button>
              <button id="bob-e-measure" class="btn">Bob: Measure All</button>
              <button id="bb84-e-reset" class="btn btn-outline">Reset</button>
            </div>

            <div class="bb84-headers-e" style="display:grid; grid-template-columns:3ch 1fr 2ch 1fr 2ch 1fr 6ch; align-items:center; gap:0.6rem; padding:0.2rem 0.4rem; color:#cfe9ff; font-weight:600;">
              <div style="grid-column:1"></div>
              <div style="grid-column:2; text-align:left">Alice ‚Äî Basis & Value</div>
              <div style="grid-column:3; text-align:center"></div>
              <div style="grid-column:4; text-align:center">Eve ‚Äî Basis & Value</div>
              <div style="grid-column:5; text-align:center"></div>
              <div style="grid-column:6; text-align:center">Bob ‚Äî Basis & Value</div>
              <div style="grid-column:7; text-align:center">Result</div>
            </div>

            <div id="bb84-e-container" style="display:grid; gap:0.6rem; grid-template-columns:1fr;">
              <!-- rows injected -->
            </div>

            <div id="bb84-e-result" style="margin-top:0.8rem; text-align:center; color:#d6e6ff;">
              <div id="bb84-e-matches" style="margin-bottom:0.4rem;"></div>
              <div id="bb84-e-key" style="font-weight:600; font-family:monospace; background:rgba(255,255,255,0.03); display:inline-block; padding:0.4rem 0.6rem; border-radius:4px;"></div>
            </div>
          </div>

          <h3>What you'll practice in Level 3</h3>
          <ul>
            <li>3.1 ‚Äî You don't know Alice's measurements. See if you can successfully intercept their key.</li>
            <li>3.2 ‚Äî You know Alice's measurements. See if you can successfully intercept their key.</li>
          </ul>

          <p style="margin-top:1rem; font-style:italic; color:#cfdcff;">Key Takeaway : You will see just how robust Quantum Key Cryptography is, along with its weaknesses that we can try to exploit.</p>
        </div>

        <!-- Navigation links removed: this Materials page is self-contained -->
      </section>
    </main>

    <footer>
      &copy; CCST9077 | Members :
    </footer>

    <!-- Levels slide-out tab -->
    <div id="levels-tab" title="Open levels">Levels</div>
    <aside id="levels-sidebar" aria-hidden="true">
      <button id="levels-close" class="btn btn-outline">Close</button>
      <h3>Levels</h3>
      <ul class="levels-list">
        <li><a href="game.html">Level 1 ‚Äî Caesar's Cipher</a></li>
        <li><a href="level2.html">Level 2 ‚Äî Modern Crypto (MCQ)</a></li>
        <li><a href="level3_materials.html">Level 3 ‚Äî QKD Materials</a></li>
      </ul>
    </aside>

    <script>
      (function(){
        const tab = document.getElementById('levels-tab');
        const sidebar = document.getElementById('levels-sidebar');
        const closeBtn = document.getElementById('levels-close');
        if(tab && sidebar){
          tab.addEventListener('click', ()=>{ sidebar.classList.add('open'); sidebar.setAttribute('aria-hidden','false'); });
          closeBtn.addEventListener('click', ()=>{ sidebar.classList.remove('open'); sidebar.setAttribute('aria-hidden','true'); });
          document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ sidebar.classList.remove('open'); sidebar.setAttribute('aria-hidden','true'); } });
        }
      })();
    </script>

    <!-- Caesar Cipher Wheel Script -->
    <script>
      (function(){
        const wheelSvg = document.getElementById('caesar-wheel-svg');
        const wheelShiftInput = document.getElementById('caesar-shift');
        const wheelShiftLabel = document.getElementById('caesar-shift-label');
        const plainLetterInput = document.getElementById('plain-letter');
        const cipherLetterEl = document.getElementById('cipher-letter');
        
        if(!wheelSvg) return;
        
        const SVG_NS = 'http://www.w3.org/2000/svg';
        let wheelOuterGroup = null;
        let wheelInnerGroup = null;
        const cx = 130, cy = 130, rInner = 80, rOuter = 110;
        const stepDeg = 360 / 26;
        
        let currentOuterAngle = 0;
        let animFrame = null;
        
        function createSVGEl(name, attrs = {}) {
          const el = document.createElementNS(SVG_NS, name);
          for (const [k, v] of Object.entries(attrs)) el.setAttribute(k, v);
          return el;
        }
        
        function buildCipherWheel() {
          wheelSvg.innerHTML = '';
          
          // Background rings
          wheelSvg.appendChild(createSVGEl('circle', { cx, cy, r: rOuter + 8 }));
          wheelSvg.appendChild(createSVGEl('circle', { cx, cy, r: rInner - 8 }));
          
          wheelInnerGroup = createSVGEl('g', { class: 'inner-ring' });
          wheelOuterGroup = createSVGEl('g', { class: 'outer-ring' });
          
          for (let i = 0; i < 26; i++) {
            const letter = String.fromCharCode(65 + i);
            const angle = (i / 26) * 2 * Math.PI - Math.PI / 2;
            
            const xi = cx + rInner * Math.cos(angle);
            const yi = cy + rInner * Math.sin(angle);
            const xo = cx + rOuter * Math.cos(angle);
            const yo = cy + rOuter * Math.sin(angle);
            
            const tInner = createSVGEl('text', { x: xi, y: yi });
            tInner.textContent = letter;
            const tOuter = createSVGEl('text', { x: xo, y: yo });
            tOuter.textContent = letter;
            
            wheelInnerGroup.appendChild(tInner);
            wheelOuterGroup.appendChild(tOuter);
          }
          
          wheelSvg.appendChild(wheelInnerGroup);
          wheelSvg.appendChild(wheelOuterGroup);
          currentOuterAngle = 0;
          wheelOuterGroup.setAttribute('transform', `rotate(${currentOuterAngle} ${cx} ${cy})`);
        }
        
        function setWheelShift(s, animate = true) {
          if (!wheelOuterGroup) return;
          const targetAngle = s * stepDeg;
          wheelShiftLabel.textContent = s >= 0 ? `+${s}` : `${s}`;
          
          if (!animate) {
            if (animFrame) { cancelAnimationFrame(animFrame); animFrame = null; }
            currentOuterAngle = targetAngle;
            wheelOuterGroup.setAttribute('transform', `rotate(${currentOuterAngle} ${cx} ${cy})`);
            return;
          }
          
          // Smooth animation
          const startAngle = currentOuterAngle;
          const delta = targetAngle - startAngle;
          const duration = 400;
          const startTime = performance.now();
          
          if (animFrame) { cancelAnimationFrame(animFrame); animFrame = null; }
          
          function step(t) {
            const k = Math.min(1, (t - startTime) / duration);
            const eased = 1 - Math.pow(1 - k, 3);
            const angle = startAngle + delta * eased;
            wheelOuterGroup.setAttribute('transform', `rotate(${angle} ${cx} ${cy})`);
            if (k < 1) animFrame = requestAnimationFrame(step);
            else { currentOuterAngle = targetAngle; animFrame = null; }
          }
          animFrame = requestAnimationFrame(step);
        }
        
        function encryptLetter(letter, shift) {
          const code = letter.charCodeAt(0);
          if (code >= 65 && code <= 90) { // A-Z
            return String.fromCharCode(((code - 65 + shift + 26) % 26) + 65);
          } else if (code >= 97 && code <= 122) { // a-z
            return String.fromCharCode(((code - 97 + shift + 26) % 26) + 97);
          }
          return letter;
        }
        
        function encryptWord(word, shift) {
          return word.split('').map(letter => encryptLetter(letter, shift)).join('');
        }
        
        function updateCipherLetter() {
          const plain = plainLetterInput.value.toUpperCase();
          const shift = parseInt(wheelShiftInput.value, 10) || 0;
          
          if (plain.length > 0 && /^[A-Z]+$/.test(plain)) {
            cipherLetterEl.textContent = encryptWord(plain, shift);
          } else if (plain.length === 0) {
            cipherLetterEl.textContent = '-';
          } else {
            cipherLetterEl.textContent = 'Letters only';
          }
        }
        
        wheelShiftInput.addEventListener('input', () => {
          const s = parseInt(wheelShiftInput.value, 10) || 0;
          setWheelShift(s, true);
          updateCipherLetter();
        });
        
        plainLetterInput.addEventListener('input', () => {
          plainLetterInput.value = plainLetterInput.value.toUpperCase();
          updateCipherLetter();
        });
        
        // Build the wheel on load
        buildCipherWheel();
        // Initialize with HELLO
        updateCipherLetter();
      })();
    </script>

    <!-- Superposition + Materials scripts -->
    <script>
      // Superposition demo + view toggles (adapted from level2)
      (function(){
        const openBtn = document.getElementById('open-box');
        const resetBtn = document.getElementById('reset-box');
        const ball = document.getElementById('demo-ball');
        const result = document.getElementById('demo-result');
        const viewQ = document.getElementById('view-questions');
        const toEnt = document.getElementById('to-entanglement');
        const flashlight = document.getElementById('flashlight');
        // secondary demo elements (no flashlight)
        const openBtn2 = document.getElementById('open-box-2');
        const resetBtn2 = document.getElementById('reset-box-2');
        const ball2 = document.getElementById('demo-ball-2');
        const result2 = document.getElementById('demo-result-2');

        let forceLeft = false;
        let measured = false;
        let measured2 = false;

        function collapse() {
          if(measured) return;
          measured = true;
          const val = forceLeft ? 0 : (Math.random() < 0.5 ? 0 : 1);
          ball.classList.remove('spin');
          if(val === 0){ ball.classList.add('left'); ball.classList.remove('right'); }
          else { ball.classList.add('right'); ball.classList.remove('left'); }
          ball.textContent = val;
          result.textContent = `Measured: ${val} (superposition collapsed)`;
          if(forceLeft) { result.textContent = `Measured: ${val} (FORCE applied ‚Äî collapsed LEFT)`; result.classList.add('correct'); }
          else { result.classList.add('correct'); }
          openBtn.disabled = true;
        }

        function reset() {
          measured = false;
          ball.classList.remove('left','right');
          ball.classList.add('spin');
          ball.textContent = '?';
          result.textContent = forceLeft ? 'Force still active ‚Äî next collapse will be LEFT' : '';
          result.classList.remove('correct');
          openBtn.disabled = false;
        }

        function collapse2(){
          if(measured2) return;
          measured2 = true;
          const val = Math.random() < 0.5 ? 0 : 1;
          ball2.classList.remove('spin');
          if(val === 0){ ball2.classList.add('left'); ball2.classList.remove('right'); }
          else { ball2.classList.add('right'); ball2.classList.remove('left'); }
          ball2.textContent = val;
          result2.textContent = `Measured: ${val} (superposition collapsed)`;
          result2.classList.add('correct');
          if(openBtn2) openBtn2.disabled = true;
        }

        function reset2(){
          measured2 = false;
          if(ball2) { ball2.classList.remove('left','right'); ball2.classList.add('spin'); ball2.textContent = '?'; }
          if(result2) { result2.textContent = ''; result2.classList.remove('correct'); }
          if(openBtn2) openBtn2.disabled = false;
        }

        let pulseTimeout = null;
        const demoArea = document.querySelector('.demo-area');
        const demoBox = document.querySelector('.demo-box');
        function energizePulse(){
          if(!demoArea) return;
          demoArea.classList.remove('energized');
          demoBox && demoBox.classList.remove('glow');
          void demoArea.offsetWidth;
          demoArea.classList.add('energized');
          demoBox && demoBox.classList.add('glow');
          clearTimeout(pulseTimeout);
          pulseTimeout = setTimeout(()=>{ demoArea.classList.remove('energized'); demoBox && demoBox.classList.remove('glow'); }, 1000);
        }

        if(flashlight){
          flashlight.addEventListener('click', ()=>{
            forceLeft = !forceLeft;
            flashlight.classList.toggle('on', forceLeft);
            flashlight.textContent = forceLeft ? 'üî¶ Forced: Left' : 'üî¶ Force';
            energizePulse();
            if(!measured){ result.textContent = forceLeft ? 'Force applied: collapse will be LEFT' : ''; }
          });
        }

        if(openBtn) openBtn.addEventListener('click', collapse);
        if(resetBtn) resetBtn.addEventListener('click', reset);
        if(openBtn2) openBtn2.addEventListener('click', collapse2);
        if(resetBtn2) resetBtn2.addEventListener('click', reset2);
        if(viewQ) viewQ.addEventListener('click', ()=>{ window.location.href = 'level2.html#mcq'; });
        if(toEnt) toEnt.addEventListener('click', ()=>{ window.location.href = 'entanglement.html'; });

        reset();
      })();
    </script>

    <script>
      // Entanglement demo logic (adapted from entanglement page)
      (function(){
        const left = document.getElementById('ent-ball-l');
        const right = document.getElementById('ent-ball-r');
        const measureL = document.getElementById('measure-l');
        const measureR = document.getElementById('measure-r');
        const resetBtn = document.getElementById('reset-ent');
        const resL = document.getElementById('ent-result-l');
        const resR = document.getElementById('ent-result-r');

        let entValue = null;
        let measuredLeft = false;
        let measuredRight = false;

        function revealOnSide(sideEl, resultEl, val){
          sideEl.classList.remove('spin');
          sideEl.classList.toggle('left', val===0);
          sideEl.classList.toggle('right', val===1);
          sideEl.textContent = val;
          resultEl.textContent = `Measured: ${val}`;
          resultEl.classList.add('correct');
        }

        function measureLeft(){
          if(measuredLeft) return;
          if(entValue === null) entValue = Math.random() < 0.5 ? 0 : 1;
          revealOnSide(left, resL, entValue);
          measuredLeft = true;
          measureL.disabled = true;
        }

        function measureRight(){
          if(measuredRight) return;
          if(entValue === null) entValue = Math.random() < 0.5 ? 0 : 1;
          revealOnSide(right, resR, entValue);
          measuredRight = true;
          measureR.disabled = true;
        }

        function reset(){
          entValue = null;
          measuredLeft = false; measuredRight = false;
          [left,right].forEach(b=>{ b.classList.remove('left','right'); b.classList.add('spin'); b.textContent='?'; });
          resL.textContent = ''; resR.textContent = '';
          if(measureL) measureL.disabled = false;
          if(measureR) measureR.disabled = false;
        }

        measureL && measureL.addEventListener('click', measureLeft);
        measureR && measureR.addEventListener('click', measureRight);
        resetBtn && resetBtn.addEventListener('click', reset);
        reset();
      })();
    </script>

    <script>
      (function(){
        // Enhanced BB84 5-qubit interactive simulation (modern basis selectors + key label)
        const N = 5;
        let trueBases = [];
        let trueBits = [];
        let aliceBases = Array(N).fill(null);
        let aliceBits = Array(N).fill(null);
        let bobBases = Array(N).fill(null);
        let bobBits = Array(N).fill(null);

        const container = document.getElementById('bb84-container');
        const genBtn = document.getElementById('bb84-gen');
        const aliceBtn = document.getElementById('alice-measure');
        const bobBtn = document.getElementById('bob-measure');
        const resetBtn = document.getElementById('bb84-reset');
        const matchesEl = document.getElementById('bb84-matches');
        const keyEl = document.getElementById('bb84-key');

        function randBit(){ return Math.random() < 0.5 ? 0 : 1; }

        function makeBasisSelector(i, role){
          const wrapper = document.createElement('div');
          wrapper.style.display = 'flex'; wrapper.style.gap = '0.25rem';
          wrapper.className = role === 'alice' ? 'alice-selector' : 'bob-selector';

          ['+','x'].forEach(sym => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'basis-btn';
            btn.textContent = sym;
            btn.dataset.index = i;
            btn.dataset.sym = sym;
            btn.style.padding = '0.28rem 0.5rem';
            btn.style.borderRadius = '6px';
            btn.style.border = '1px solid rgba(255,255,255,0.08)';
            btn.style.background = 'transparent';
            btn.style.color = '#cfe9ff';
            btn.style.minWidth = '2.2rem';
            btn.style.fontWeight = '600';
            btn.onclick = (e)=>{
              const idx = Number(e.currentTarget.dataset.index);
              const s = e.currentTarget.dataset.sym;
              if(role === 'alice'){
                aliceBases[idx] = s; // set chosen basis
                // toggle selected styling for this row's alice buttons
                const rowBtns = e.currentTarget.parentElement.querySelectorAll('.basis-btn');
                rowBtns.forEach(b=> b.style.background = b === e.currentTarget ? 'linear-gradient(90deg,#1b6cff,#3dd0ff)' : 'transparent');
                rowBtns.forEach(b=> b.style.color = b === e.currentTarget ? '#001723' : '#cfe9ff');
              } else {
                bobBases[idx] = s;
                const rowBtns = e.currentTarget.parentElement.querySelectorAll('.basis-btn');
                rowBtns.forEach(b=> b.style.background = b === e.currentTarget ? 'linear-gradient(90deg,#8ef5a1,#27c07a)' : 'transparent');
                rowBtns.forEach(b=> b.style.color = b === e.currentTarget ? '#003216' : '#cfe9ff');
              }
            };
            wrapper.appendChild(btn);
          });

          return wrapper;
        }

        function makeRow(i){
          const row = document.createElement('div');
          row.className = 'bb84-row';
          row.style.display = 'grid';
          row.style.gridTemplateColumns = '3ch 1fr 2ch 1fr 6ch';
          row.style.alignItems = 'center';
          row.style.gap = '0.6rem';
          row.style.padding = '0.4rem';
          row.style.background = 'rgba(255,255,255,0.02)';
          row.style.borderRadius = '6px';

          const idx = document.createElement('div'); idx.textContent = `Q${i+1}`; idx.style.width = '3ch'; idx.style.textAlign = 'center'; idx.style.fontWeight = '600'; idx.style.color = '#dbe7ff';

          const aliceSel = makeBasisSelector(i, 'alice');
          const aliceVal = document.createElement('div'); aliceVal.id = `alice-bit-${i}`; aliceVal.textContent = '‚Äì'; aliceVal.style.minWidth = '2ch'; aliceVal.style.textAlign = 'center'; aliceVal.style.color = '#cfe9ff'; aliceVal.style.fontWeight = '700';

          const arrow = document.createElement('div'); arrow.textContent = '‚Üí'; arrow.style.opacity = 0.8; arrow.style.width = '2ch'; arrow.style.textAlign = 'center'; arrow.style.color = '#cfe9ff';

          const bobSel = makeBasisSelector(i, 'bob');
          const bobVal = document.createElement('div'); bobVal.id = `bob-bit-${i}`; bobVal.textContent = '‚Äì'; bobVal.style.minWidth = '2ch'; bobVal.style.textAlign = 'center'; bobVal.style.color = '#cfe9ff'; bobVal.style.fontWeight = '700';

          const status = document.createElement('div'); status.id = `match-${i}`; status.style.minWidth = '6ch'; status.style.textAlign = 'center'; status.style.fontSize = '0.9rem'; status.style.color = '#cfe9ff';

          const aGroup = document.createElement('div'); aGroup.style.display='flex'; aGroup.style.gap='0.5rem'; aGroup.style.alignItems='center'; aGroup.appendChild(aliceSel); aGroup.appendChild(aliceVal);
          const bGroup = document.createElement('div'); bGroup.style.display='flex'; bGroup.style.gap='0.5rem'; bGroup.style.alignItems='center'; bGroup.appendChild(bobSel); bGroup.appendChild(bobVal);

          // Append five cells matching the header: idx, Alice group, arrow, Bob group, result
          row.appendChild(idx);
          row.appendChild(aGroup);
          row.appendChild(arrow);
          row.appendChild(bGroup);
          row.appendChild(status);

          return row;
        }

        function renderGrid(){
          container.innerHTML = '';
          for(let i=0;i<N;i++) container.appendChild(makeRow(i));
          matchesEl.textContent = '';
          keyEl.textContent = 'Key : ';
        }

        function generateSequence(){
          trueBases = Array.from({length:N}, ()=> Math.random() < 0.5 ? '+' : 'x');
          trueBits = Array.from({length:N}, ()=> randBit());
          aliceBases.fill(null); aliceBits.fill(null); bobBases.fill(null); bobBits.fill(null);
          renderGrid();
        }

        function aliceMeasure(){
          // ensure all alice bases chosen
          for(let i=0;i<N;i++) if(!aliceBases[i]){ alert('Choose a basis for all qubits as Alice before measuring.'); return; }
          for(let i=0;i<N;i++){
            const chosen = aliceBases[i];
            if(chosen === trueBases[i]) aliceBits[i] = trueBits[i];
            else aliceBits[i] = randBit();
            // collapse
            trueBases[i] = chosen; trueBits[i] = aliceBits[i];
            document.getElementById(`alice-bit-${i}`).textContent = aliceBits[i];
            document.getElementById(`match-${i}`).textContent = '';
            document.getElementById(`bob-bit-${i}`).textContent = '‚Äì';
          }
          matchesEl.textContent = 'Alice measured. Now choose Bob bases and measure.';
          keyEl.textContent = 'Key : ';
        }

        function bobMeasure(){
          for(let i=0;i<N;i++) if(!bobBases[i]){ alert('Choose a basis for all qubits as Bob before measuring.'); return; }
          for(let i=0;i<N;i++){
            const chosen = bobBases[i];
            if(chosen === trueBases[i]) bobBits[i] = trueBits[i];
            else bobBits[i] = randBit();
            document.getElementById(`bob-bit-${i}`).textContent = bobBits[i];
            const matchEl = document.getElementById(`match-${i}`);
            if(aliceBases[i] && bobBases[i]){
              if(aliceBases[i] === bobBases[i]){ matchEl.textContent = 'MATCH'; matchEl.style.color = '#9bf59b'; }
              else { matchEl.textContent = 'DIFF'; matchEl.style.color = '#f59b9b'; }
            }
          }
          const keyBits = [];
          const matches = [];
          for(let i=0;i<N;i++){
            if(aliceBases[i] && bobBases[i] && aliceBases[i] === bobBases[i]){ keyBits.push(String(aliceBits[i])); matches.push(i+1); }
          }
          matchesEl.textContent = matches.length ? `Matched positions: ${matches.join(', ')}` : 'No matching bases ‚Äî no key bits kept.';
          keyEl.textContent = keyBits.length ? `Key : ${keyBits.join('')}` : 'Key : (empty)';
        }

        genBtn.addEventListener('click', generateSequence);
        aliceBtn.addEventListener('click', aliceMeasure);
        bobBtn.addEventListener('click', bobMeasure);
        resetBtn.addEventListener('click', ()=>{ generateSequence(); });

        generateSequence();
      })();
    </script>
    <script>
      (function(){
        // BB84 with Eve simulation (5 qubits)
        const N = 5;
        let trueBasesE = [];
        let trueBitsE = [];
        let aliceBasesE = Array(N).fill(null), aliceBitsE = Array(N).fill(null);
        let eveBases = Array(N).fill(null), eveBits = Array(N).fill(null);
        let bobBasesE = Array(N).fill(null), bobBitsE = Array(N).fill(null);

        const cont = document.getElementById('bb84-e-container');
        const gen = document.getElementById('bb84-e-gen');
        const aBtn = document.getElementById('alice-e-measure');
        const eBtn = document.getElementById('eve-measure');
        const bBtn = document.getElementById('bob-e-measure');
        const rBtn = document.getElementById('bb84-e-reset');
        const matchesE = document.getElementById('bb84-e-matches');
        const keyE = document.getElementById('bb84-e-key');

        function randBit(){ return Math.random() < 0.5 ? 0 : 1; }

        function makeSelector(i, role, prefix){
          const wrapper = document.createElement('div'); wrapper.style.display='flex'; wrapper.style.gap='0.25rem';
          ['+','x'].forEach(sym=>{
            const btn = document.createElement('button'); btn.type='button'; btn.className='basis-btn'; btn.textContent=sym;
            btn.dataset.index = i; btn.dataset.sym = sym;
            btn.onclick = (ev)=>{
              const idx = Number(ev.currentTarget.dataset.index); const s = ev.currentTarget.dataset.sym;
              if(role==='alice') { aliceBasesE[idx]=s; }
              else if(role==='eve') { eveBases[idx]=s; }
              else { bobBasesE[idx]=s; }
              // visual toggle styling
              const rowBtns = ev.currentTarget.parentElement.querySelectorAll('.basis-btn');
              rowBtns.forEach(b=> b.style.background = b===ev.currentTarget ? (role==='alice' ? 'linear-gradient(90deg,#1b6cff,#3dd0ff)' : role==='eve' ? 'linear-gradient(90deg,#f5d36b,#f59b42)' : 'linear-gradient(90deg,#8ef5a1,#27c07a)') : 'transparent');
              rowBtns.forEach(b=> b.style.color = b===ev.currentTarget ? (role==='eve' ? '#2b1a00' : '#001723') : '#cfe9ff');
            };
            wrapper.appendChild(btn);
          });
          return wrapper;
        }

        function makeRow(i){
          const row = document.createElement('div');
          row.style.display='grid';
          row.style.gridTemplateColumns='3ch 1fr 2ch 1fr 2ch 1fr 6ch';
          row.style.alignItems='center';
          row.style.gap='0.6rem';
          row.style.padding='0.4rem';
          row.style.background='rgba(255,255,255,0.01)';
          row.style.borderRadius='6px';

          const idx = document.createElement('div');
          idx.textContent = `Q${i+1}`;
          idx.style.textAlign='center'; idx.style.fontWeight='600'; idx.style.color='#dbe7ff';

          // Alice group (selector + value)
          const aSel = makeSelector(i,'alice');
          const aVal = document.createElement('div');
          aVal.id = `alice-e-bit-${i}`; aVal.textContent='‚Äì'; aVal.style.textAlign='center'; aVal.style.color='#cfe9ff'; aVal.style.fontWeight='700';
          const aGroup = document.createElement('div');
          aGroup.style.display='flex'; aGroup.style.gap='0.5rem'; aGroup.style.alignItems='center';
          aGroup.appendChild(aSel); aGroup.appendChild(aVal);

          // Arrow between Alice and Eve
          const arrow = document.createElement('div'); arrow.textContent='‚Üí'; arrow.style.textAlign='center'; arrow.style.color='#cfe9ff';

          // Eve group (selector + value)
          const eSel = makeSelector(i,'eve');
          const eVal = document.createElement('div'); eVal.id = `eve-bit-${i}`; eVal.textContent='‚Äì'; eVal.style.textAlign='center'; eVal.style.color='#f8e3c2'; eVal.style.fontWeight='700';
          const eGroup = document.createElement('div'); eGroup.style.display='flex'; eGroup.style.gap='0.5rem'; eGroup.style.alignItems='center'; eGroup.appendChild(eSel); eGroup.appendChild(eVal);

          // Arrow between Eve and Bob
          const arrow2 = document.createElement('div'); arrow2.textContent='‚Üí'; arrow2.style.textAlign='center'; arrow2.style.color='#cfe9ff';

          // Bob group (selector + value)
          const bSel = makeSelector(i,'bob');
          const bVal = document.createElement('div'); bVal.id = `bob-e-bit-${i}`; bVal.textContent='‚Äì'; bVal.style.textAlign='center'; bVal.style.color='#cfe9ff'; bVal.style.fontWeight='700';
          const bGroup = document.createElement('div'); bGroup.style.display='flex'; bGroup.style.gap='0.5rem'; bGroup.style.alignItems='center'; bGroup.appendChild(bSel); bGroup.appendChild(bVal);

          const status = document.createElement('div'); status.id = `match-e-${i}`; status.style.textAlign='center'; status.style.fontSize='0.9rem'; status.style.color='#cfe9ff';

          // Append exactly seven cells matching the header grid: idx, Alice group, arrow, Eve group, arrow2, Bob group, result
          row.appendChild(idx);
          row.appendChild(aGroup);
          row.appendChild(arrow);
          row.appendChild(eGroup);
          row.appendChild(arrow2);
          row.appendChild(bGroup);
          row.appendChild(status);

          return row;
        }

        function render(){ cont.innerHTML=''; for(let i=0;i<N;i++) cont.appendChild(makeRow(i)); matchesE.textContent=''; keyE.textContent='Key : '; }

        function generate(){ trueBasesE = Array.from({length:N}, ()=> Math.random() < 0.5 ? '+' : 'x'); trueBitsE = Array.from({length:N}, ()=> randBit()); aliceBasesE.fill(null); aliceBitsE.fill(null); eveBases.fill(null); eveBits.fill(null); bobBasesE.fill(null); bobBitsE.fill(null); render(); }

        function aliceMeasure(){ for(let i=0;i<N;i++) if(!aliceBasesE[i]){ alert('Pick all Alice bases first'); return; } for(let i=0;i<N;i++){ const c=aliceBasesE[i]; if(c===trueBasesE[i]) aliceBitsE[i]=trueBitsE[i]; else aliceBitsE[i]=randBit(); // collapse
            trueBasesE[i]=c; trueBitsE[i]=aliceBitsE[i]; document.getElementById(`alice-e-bit-${i}`).textContent = aliceBitsE[i]; document.getElementById(`eve-bit-${i}`).textContent='‚Äì'; document.getElementById(`bob-e-bit-${i}`).textContent='‚Äì'; document.getElementById(`match-e-${i}`).textContent=''; }
          matchesE.textContent='Alice measured. Now decide whether Eve intercepts.'; keyE.textContent='Key : ';
        }

        function eveIntercept(){ for(let i=0;i<N;i++) if(!eveBases[i]){ alert('Pick Eve bases for all qubits (or leave none to skip).'); return; } for(let i=0;i<N;i++){ const c=eveBases[i]; if(c===trueBasesE[i]) eveBits[i]=trueBitsE[i]; else eveBits[i]=randBit(); // Eve collapses the qubit
            trueBasesE[i]=c; trueBitsE[i]=eveBits[i]; document.getElementById(`eve-bit-${i}`).textContent = eveBits[i]; document.getElementById(`bob-e-bit-${i}`).textContent='‚Äì'; document.getElementById(`match-e-${i}`).textContent=''; }
          matchesE.textContent='Eve has intercepted. Now choose Bob bases and measure.'; keyE.textContent='Key : ';
        }

        function bobMeasure(){ for(let i=0;i<N;i++) if(!bobBasesE[i]){ alert('Pick all Bob bases first'); return; } for(let i=0;i<N;i++){ const c=bobBasesE[i]; if(c===trueBasesE[i]) bobBitsE[i]=trueBitsE[i]; else bobBitsE[i]=randBit(); document.getElementById(`bob-e-bit-${i}`).textContent = bobBitsE[i]; const matchEl=document.getElementById(`match-e-${i}`);
            if(aliceBasesE[i] && bobBasesE[i]){ if(aliceBasesE[i]===bobBasesE[i]){ matchEl.textContent='MATCH'; matchEl.style.color='#9bf59b'; } else { matchEl.textContent='DIFF'; matchEl.style.color='#f59b9b'; } }
          }
          // derive key and show error rate
          const keyBits=[]; const matched=[]; let errors=0; let checks=0;
          for(let i=0;i<N;i++){
            // only keep bits where Alice and Bob used same basis
            if(aliceBasesE[i] && bobBasesE[i] && aliceBasesE[i]===bobBasesE[i]){
              checks++;
              matched.push(i+1);
              // If Eve intercepted using a different basis than Alice, Bob's qubit should be uncorrelated with Alice (random)
              // We already simulated Eve collapsing the qubit into trueBitsE when she intercepted. To make the effect explicit,
              // compare the stored Alice bit with Bob's measured bit and count errors.
              if(aliceBitsE[i] !== bobBitsE[i]) errors++; else keyBits.push(String(aliceBitsE[i]));
            }
          }
          matchesE.textContent = matched.length ? `Matched positions: ${matched.join(', ')} (errors: ${errors}/${checks})` : 'No matching bases ‚Äî no key bits kept.';
          keyE.textContent = keyBits.length ? `Key : ${keyBits.join('')}` : 'Key : (empty)';
        }

        gen.addEventListener('click', generate); aBtn.addEventListener('click', aliceMeasure); eBtn.addEventListener('click', eveIntercept); bBtn.addEventListener('click', bobMeasure); rBtn.addEventListener('click', generate);
        generate();
      })();
    </script>
  </body>

  <!-- PARALLAX EFFECT SCRIPT -->
  <script>
    (function(){
      const page = document.querySelector('main.page');
      if(!page) return;
      
      let ticking = false;
      const parallaxSpeed = -0.025;
      
      // Calculate initial offset to prevent jump
      const initialScroll = window.pageYOffset;
      const initialOffset = initialScroll * parallaxSpeed;
      
      function updateParallax() {
        const scrolled = window.pageYOffset;
        const offset = scrolled * parallaxSpeed;
        
        // Apply offset relative to initial position
        page.style.backgroundPositionY = `calc(50% + ${offset}px)`;
        
        ticking = false;
      }
      
      function requestTick() {
        if (!ticking) {
          window.requestAnimationFrame(updateParallax);
          ticking = true;
        }
      }
      
      // Set initial position
      page.style.backgroundPositionY = `calc(50% + ${initialOffset}px)`;
      
      window.addEventListener('scroll', requestTick, { passive: true });
    })();
  </script>
  <!-- END PARALLAX EFFECT SCRIPT -->

  <!-- Audio element for background music -->
  <audio id="bgm" loop>
    <source src="media/bgm.mp3" type="audio/mpeg">
  </audio>
  <div id="settings-btn">‚öôÔ∏è</div>
  <div id="settings-menu">
    <div id="mute-option" class="option">Mute Music</div>
    <div id="theme-option" class="option">üîÑ Larger Fonts (Accessibility)</div>
  </div>
  <div id="info-container">
    <div id="info-icon">‚Ñπ</div>
    <div id="info-popup">This project is an informative and educational website designed to make information on quantum cryptography accessible to a wider audience.</div>
  </div>

  <!-- BACKGROUND MUSIC SYSTEM -->
  <script>
    (function(){
      const bgm = document.getElementById('bgm');
      if(!bgm) return;
      const btn = document.getElementById('settings-btn');
      const menu = document.getElementById('settings-menu');
      const muteOption = document.getElementById('mute-option');
      let menuOpen = false;

      let savedMuted = localStorage.getItem('musicMuted') === 'true';
      let savedTime = parseFloat(localStorage.getItem('musicTime')) || 0;
      bgm.muted = savedMuted;
      bgm.currentTime = savedTime;

      window.addEventListener('click', ()=>{ bgm.play().catch(()=>{}); bgm.volume = 0.2; }, { once: true });
      bgm.volume = 0.2; bgm.play().catch(()=>{});

      setInterval(()=>{ localStorage.setItem('musicTime', bgm.currentTime); }, 1000);

      btn.onclick = ()=>{ menuOpen = !menuOpen; menu.style.display = menuOpen ? 'block' : 'none'; };
      muteOption.onclick = ()=>{ bgm.muted = !bgm.muted; localStorage.setItem('musicMuted', bgm.muted); muteOption.textContent = bgm.muted ? 'Unmute Music' : 'Mute Music'; };
      muteOption.textContent = bgm.muted ? 'Unmute Music' : 'Mute Music';
    })();
  </script>
  <!-- END BACKGROUND MUSIC SYSTEM -->

  <!-- THEME SWITCHER SCRIPT -->
  <script>
    (function(){
      const themeOption = document.getElementById('theme-option');
      const themeSheet = document.getElementById('theme-stylesheet');
      if(!themeOption || !themeSheet) return;

      let useAccessibleTheme = localStorage.getItem('useAccessibleTheme') === 'true';
      
      function applyTheme(accessible) {
        if(accessible) {
          themeSheet.href = 'styl2.css';
          themeOption.textContent = 'üîÑ Standard Fonts';
          localStorage.setItem('useAccessibleTheme', 'true');
        } else {
          themeSheet.href = 'style.css';
          themeOption.textContent = 'üîÑ Larger Fonts (Accessibility)';
          localStorage.setItem('useAccessibleTheme', 'false');
        }
      }

      applyTheme(useAccessibleTheme);

      themeOption.addEventListener('click', ()=>{
        useAccessibleTheme = !useAccessibleTheme;
        applyTheme(useAccessibleTheme);
      });
    })();
  </script>
  <!-- END THEME SWITCHER SCRIPT -->
</html>
